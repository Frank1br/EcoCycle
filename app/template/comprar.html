{% extends 'base.html' %}

{% block content %}
<style>
    /* ============================================
       ESTILOS ESPECÍFICOS DA PÁGINA DE COMPRA
       ============================================ */

    /* Container Principal */
    .product-detail-container {
        padding: 3rem 0;
    }

    /* Breadcrumb */
    .breadcrumb-custom {
        background: none;
        padding: 0;
        margin-bottom: 2rem;
    }

    .breadcrumb-custom .breadcrumb-item {
        font-size: 0.9rem;
    }

    .breadcrumb-custom .breadcrumb-item a {
        color: var(--text-light);
        text-decoration: none;
        transition: color 0.3s ease;
    }

    .breadcrumb-custom .breadcrumb-item a:hover {
        color: var(--primary-green);
    }

    .breadcrumb-custom .breadcrumb-item.active {
        color: var(--text-dark);
        font-weight: 600;
    }

    /* Card de Imagem do Produto */
    .product-image-card {
        background: var(--white);
        border-radius: var(--radius-lg);
        padding: 2.5rem;
        box-shadow: var(--shadow-md);
        margin-bottom: 2rem;
        text-align: center;
    }

    .product-image-wrapper {
        position: relative;
        height: 400px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #F8FAFC;
        border-radius: var(--radius-md);
        overflow: hidden;
        margin-bottom: 1.5rem;
    }

    .product-image-wrapper img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
    }

    .eco-badge-large {
        position: absolute;
        top: 1.5rem;
        right: 1.5rem;
        background: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-green-hover) 100%);
        color: var(--white);
        padding: 0.625rem 1.25rem;
        border-radius: 50px;
        font-size: 0.85rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    /* Card de Detalhes do Produto */
    .product-details-card {
        background: var(--white);
        border-radius: var(--radius-lg);
        padding: 2rem;
        box-shadow: var(--shadow-md);
        margin-bottom: 2rem;
    }

    .product-title-section h1 {
        font-size: 2rem;
        font-weight: 800;
        color: var(--text-dark);
        margin-bottom: 0.75rem;
    }

    .product-meta {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        margin-bottom: 1.5rem;
        padding-bottom: 1.5rem;
        border-bottom: 2px solid var(--border-light);
    }

    .meta-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        background: #F8FAFC;
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-size: 0.85rem;
        color: var(--text-dark);
        font-weight: 600;
    }

    .meta-badge i {
        color: var(--primary-green);
        font-size: 1rem;
    }

    .product-description {
        color: var(--text-light);
        line-height: 1.8;
        font-size: 1.05rem;
        margin-bottom: 2rem;
    }

    /* Features List */
    .features-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .features-list li {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 0;
        color: var(--text-dark);
    }

    .features-list li i {
        color: var(--primary-green);
        font-size: 1.25rem;
    }

    /* Card de Compra (Sticky) */
    .purchase-card {
        background: var(--white);
        border-radius: var(--radius-lg);
        padding: 2rem;
        box-shadow: var(--shadow-lg);
        position: sticky;
        top: 100px;
    }

    .price-section {
        text-align: center;
        padding: 1.5rem;
        background: linear-gradient(135deg, #F8FAFC 0%, #E2E8F0 100%);
        border-radius: var(--radius-md);
        margin-bottom: 1.5rem;
    }

    .price-label {
        font-size: 0.9rem;
        color: var(--text-light);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .price-value {
        font-size: 3rem;
        font-weight: 800;
        color: var(--primary-green);
        line-height: 1;
        display: flex;
        align-items: baseline;
        justify-content: center;
        gap: 0.5rem;
    }

    .price-value small {
        font-size: 1.5rem;
        color: var(--text-light);
        font-weight: 600;
    }

    .installment-info {
        font-size: 0.9rem;
        color: var(--text-light);
        margin-top: 0.75rem;
    }

    /* Quantidade */
    .quantity-section {
        margin-bottom: 1.5rem;
    }

    .quantity-label {
        font-weight: 700;
        color: var(--text-dark);
        margin-bottom: 0.75rem;
        display: block;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .quantity-control {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .quantity-input {
        flex: 1;
        border: 2px solid var(--border-light);
        border-radius: var(--radius-sm);
        padding: 0.875rem 1rem;
        font-size: 1.1rem;
        font-weight: 600;
        text-align: center;
        transition: all 0.3s ease;
    }

    .quantity-input:focus {
        border-color: var(--primary-green);
        box-shadow: 0 0 0 0.2rem rgba(16, 185, 129, 0.15);
        outline: none;
    }

    .stock-info {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.875rem 1rem;
        background: #F0FDF4;
        border-radius: var(--radius-sm);
        color: #166534;
        font-size: 0.85rem;
        font-weight: 600;
        margin-top: 0.75rem;
    }

    .stock-info i {
        color: var(--primary-green);
        font-size: 1rem;
    }

    /* Impacto Ambiental */
    .eco-impact {
        background: linear-gradient(135deg, #ECFDF5 0%, #D1FAE5 100%);
        border: 2px solid var(--primary-green);
        border-radius: var(--radius-md);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .eco-impact-title {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 1rem;
        font-weight: 700;
        color: #065F46;
        margin-bottom: 1rem;
    }

    .eco-impact-title i {
        font-size: 1.5rem;
        color: var(--primary-green);
    }

    .eco-impact-stats {
        display: grid;
        gap: 0.75rem;
    }

    .eco-stat {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        color: #065F46;
        font-size: 0.9rem;
    }

    .eco-stat i {
        color: var(--primary-green);
    }

    .eco-stat strong {
        font-weight: 700;
    }

    /* Botão de Compra */
    .btn-purchase {
        background: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-green-hover) 100%);
        color: var(--white);
        font-weight: 700;
        font-size: 1.1rem;
        padding: 1.125rem 2rem;
        border: none;
        border-radius: var(--radius-md);
        width: 100%;
        transition: all 0.3s ease;
        box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .btn-purchase:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 30px rgba(16, 185, 129, 0.4);
        background: linear-gradient(135deg, var(--primary-green-hover) 0%, #047857 100%);
    }

    .btn-purchase i {
        margin-right: 0.75rem;
    }

    /* Garantias */
    .guarantees {
        margin-top: 1.5rem;
        padding-top: 1.5rem;
        border-top: 1px solid var(--border-light);
    }

    .guarantee-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 0;
        color: var(--text-dark);
        font-size: 0.9rem;
    }

    .guarantee-item i {
        color: var(--primary-green);
        font-size: 1.25rem;
    }

    /* Responsividade */
    @media (max-width: 991px) {
        .purchase-card {
            position: relative;
            top: 0;
        }

        .product-image-wrapper {
            height: 300px;
        }

        .price-value {
            font-size: 2.5rem;
        }
    }

    @media (max-width: 576px) {
        .product-title-section h1 {
            font-size: 1.5rem;
        }

        .price-value {
            font-size: 2rem;
        }

        .product-image-wrapper {
            height: 250px;
        }
    }
</style>

<div class="product-detail-container">
    <div class="container">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="breadcrumb-custom">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="{% url 'index' %}">
                        <i class="bi bi-house-door me-1"></i>Home
                    </a>
                </li>
                <li class="breadcrumb-item">
                    <a href="{% url 'index' %}#produtos">Produtos</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">{{ produto.nome }}</li>
            </ol>
        </nav>

        <div class="row g-4">
            <!-- Coluna Esquerda: Imagem e Detalhes -->
            <div class="col-lg-7">
                <!-- Card de Imagem -->
                <div class="product-image-card">
                    <div class="product-image-wrapper">
                        <span class="eco-badge-large">
                            <i class="bi bi-recycle"></i>
                            Recondicionado
                        </span>
                        {% if produto.foto %}
                            <img src="{{ produto.foto.url }}" alt="{{ produto.nome }}">
                        {% else %}
                            <i class="bi bi-laptop" style="font-size: 8rem; color: #CBD5E1;"></i>
                        {% endif %}
                    </div>
                </div>

                <!-- Card de Detalhes -->
                <div class="product-details-card">
                    <div class="product-title-section">
                        <h1>{{ produto.nome }}</h1>

                        <div class="product-meta">
                            <span class="meta-badge">
                                <i class="bi bi-shield-check-fill"></i>
                                Garantia 12 Meses
                            </span>
                            <span class="meta-badge">
                                <i class="bi bi-patch-check-fill"></i>
                                Certificado
                            </span>
                            <span class="meta-badge">
                                <i class="bi bi-truck"></i>
                                Frete Grátis
                            </span>
                        </div>
                    </div>

                    <div class="product-description">
                        <h3 style="font-size: 1.25rem; font-weight: 700; color: var(--text-dark); margin-bottom: 1rem;">
                            Sobre o Produto
                        </h3>
                        <p>{{ produto.descricao }}</p>
                    </div>

                    <h3 style="font-size: 1.25rem; font-weight: 700; color: var(--text-dark); margin-bottom: 1rem;">
                        <i class="bi bi-star-fill me-2" style="color: var(--primary-green);"></i>
                        Benefícios
                    </h3>
                    <ul class="features-list">
                        <li>
                            <i class="bi bi-check-circle-fill"></i>
                            <span>Produto testado e aprovado por especialistas</span>
                        </li>
                        <li>
                            <i class="bi bi-check-circle-fill"></i>
                            <span>Garantia de 12 meses contra defeitos de fabricação</span>
                        </li>
                        <li>
                            <i class="bi bi-check-circle-fill"></i>
                            <span>Economia de até 70% comparado ao produto novo</span>
                        </li>
                        <li>
                            <i class="bi bi-check-circle-fill"></i>
                            <span>Contribuição direta para redução de lixo eletrônico</span>
                        </li>
                        <li>
                            <i class="bi bi-check-circle-fill"></i>
                            <span>Suporte técnico especializado</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Coluna Direita: Card de Compra (Sticky) -->
            <div class="col-lg-5">
                <div class="purchase-card">
                    <form method="post" id="purchaseForm">
                        {% csrf_token %}

                        <!-- Mensagens de Erro -->
                        {% if messages %}
                            {% for message in messages %}
                                <div class="alert alert-danger d-flex align-items-center mb-3" role="alert">
                                    <i class="bi bi-exclamation-triangle-fill me-2 fs-5"></i>
                                    <div>{{ message }}</div>
                                </div>
                            {% endfor %}
                        {% endif %}

                        <!-- Preço -->
                        <div class="price-section">
                            <div class="price-label">Preço Especial</div>
                            <div class="price-value">
                                <small>R$</small>
                                {{ produto.preco }}
                            </div>
                            <div class="installment-info">
                                ou 12x de R$ {% widthratio produto.preco 12 1 %} sem juros
                            </div>
                        </div>

                        <!-- Impacto Ambiental -->
                        <div class="eco-impact">
                            <div class="eco-impact-title">
                                <i class="bi bi-globe2"></i>
                                Impacto Ambiental
                            </div>
                            <div class="eco-impact-stats">
                                <div class="eco-stat">
                                    <i class="bi bi-tree-fill"></i>
                                    <span>Economize até <strong>150kg de CO₂</strong></span>
                                </div>
                                <div class="eco-stat">
                                    <i class="bi bi-droplet-fill"></i>
                                    <span>Poupe <strong>20.000L de água</strong></span>
                                </div>
                                <div class="eco-stat">
                                    <i class="bi bi-recycle"></i>
                                    <span>Evite <strong>descarte de eletrônicos</strong></span>
                                </div>
                            </div>
                        </div>

                        <!-- Quantidade -->
                        <div class="quantity-section">
                            <label for="quantidade" class="quantity-label">
                                <i class="bi bi-bag-check me-2"></i>Quantidade
                            </label>
                            <div class="quantity-control">
                                <input
                                    type="number"
                                    name="quantidade"
                                    id="quantidade"
                                    class="quantity-input"
                                    min="1"
                                    max="{{ produto.estoque }}"
                                    value="1"
                                    required>
                            </div>
                            <div class="stock-info">
                                <i class="bi bi-box-seam"></i>
                                <span>{{ produto.estoque }} unidades em estoque</span>
                            </div>
                        </div>

                        <!-- Botão de Compra -->
                        <button type="submit" class="btn-purchase">
                            <i class="bi bi-cart-check-fill"></i>
                            Finalizar Pedido
                        </button>

                        <!-- Garantias -->
                        <div class="guarantees">
                            <div class="guarantee-item">
                                <i class="bi bi-shield-check"></i>
                                <span>Compra 100% segura e protegida</span>
                            </div>
                            <div class="guarantee-item">
                                <i class="bi bi-arrow-repeat"></i>
                                <span>7 dias para troca ou devolução</span>
                            </div>
                            <div class="guarantee-item">
                                <i class="bi bi-truck"></i>
                                <span>Entrega rápida em todo Brasil</span>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Script -->
<script>
    // Adiciona animação de loading ao submeter
    document.getElementById('purchaseForm').addEventListener('submit', function(e) {
        const button = this.querySelector('.btn-purchase');
        button.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Processando...';
        button.disabled = true;
    });

    // Validação de quantidade
    const quantityInput = document.getElementById('quantidade');
    quantityInput.addEventListener('change', function() {
        const max = parseInt(this.max);
        const value = parseInt(this.value);

        if (value > max) {
            this.value = max;
            alert(`Estoque disponível: ${max} unidades`);
        } else if (value < 1) {
            this.value = 1;
        }
    });
</script>
{% endblock %}
